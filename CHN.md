# SAS简明教程

## 1 简介

### 1.1 SAS 编程语言

与许多其他软件应用程序不同，它们要么是菜单驱动，要么是命令驱动，SAS 使用声明（Statement）来编写一系列指令，称为 SAS 程序。

SAS 程序是按顺序执行的一系列声明。声明向 SAS 提供信息或指令，并必须在程序中处于适当的放置。后续语句的顺序可能并不重要，但你必须从一般性的陈述开始，说明你想要做什么，比如两个基本的构建块：`DATA` 步骤和 `PROC` 步骤。

与任何语言一样，在编写 SAS 程序时需要遵循一些规则。最重要的规则是**每个 SAS 声明都以分号结尾**。

关于如何格式化编写 SAS 程序并没有硬性规定。虽然将每个声明单独放在一行上，并使用缩进来展示程序的各个部分有助于使程序看起来整洁，但这并不是必需的。

* SAS 声明可以使用大写或小写（类似于 SQL）。
* 声明可以在换行继续编写。
* 每个声明可以与其他声明在同一行编写。（只要在两个声明中间加一个分号，就可以在一行中写多个声明）。
* 语句可以从任何一列开始（与 Python 不同）。

为了使你的程序更易理解，你可以在程序中插入注释。有两种注释语法可供选择：一种以星号（\*）开头，以分号（;）结尾。另一种以斜杠星号（/\*）开头，以星号斜杠（\*/）结尾。

```sas
* This is a comment;
/* This is also a comment*/
```

由于一些操作环境会将斜杠星号（/\*）解释为一段代码的结束，使用这种注释时要小心，不要将其放在第一列。

### 1.2 SAS 数据集

数据是任何数据集的主要组成部分。在传统的SAS术语中，数据由变量（Variables）和观测（Observation）组成。采用关系数据库的术语，SAS 数据集也被称为表（Tables），观测也被称为行，变量也被称为列。

原始数据有许多不同的形式，但 SAS 进行了简化。在 SAS 中，只有两种数据类型：数值型（Numeric）和字符型（Character）。数值变量可以进行加法和减法运算，可以有任意数量的小数位，可以是正数或负数。此外，数值变量可以包含加号（+）、减号（-）、小数点（.）或科学记数法中的 "E"。字符数据包括其他所有内容。它们可以包含数字、字母或特殊字符（如\$或!），并且可以长达32,767个字符。

如果一个变量包含字母或特殊字符，它必须是一个字符变量。然而，如果它只包含数字，那么它可能是数值变量也可能是字符变量。

有时，你的数据可能是不完整的。某些观测可能缺少特定变量的值。在这些情况下，缺失的字符数据用空格表示，而缺失的数值数据用一个点（.）表示。

在 SAS 9.1之前，SAS 数据集最多可以包含32,767个变量。从 SAS 9.1开始，SAS 数据集中变量的最大数量受计算机资源的限制，但包含32,767个以上变量的 SAS 数据集无法在较早版本的 SAS 中使用。无论你使用哪个版本的 SAS，观测的数量只受计算机处理和存储能力的限制。


当为数据中的变量以及数据集起名字时，请遵循以下简单规则：

* 名字长度必须在32个字符以下。
* 名字必须以字母或下划线（_）开头。
* 名字只能包含字母、数字或下划线（_）。
* 名字可以包含大写和小写字母。

最后一点十分重要，SAS 对大小写不敏感，因此你可以使用大写、小写或混合大小写。例如，`Height`、`HEIGHT`、`height`在 SAS 中被视为相同的变量。然而，对于变量名，需要注意 SAS 会记住每个变量名第一次出现时的大小写，并在打印结果时使用该大小写。

除了实际的数据之外，SAS数据集还包含有关数据集的信息，例如其名称、创建日期以及创建它所使用的 SAS 版本。SAS 还存储有关每个变量的信息，包括其名称、标签（如果有）、类型（数值型或字符型）、长度（或存储大小）以及在数据集中的位置。这些信息有时被称为数据集的描述部分，它使 SAS 数据集具有自我记录文档的特性。

### 1.3 DATA 步骤和 PROC 步骤

SAS 程序由两个基本构建块组成：DATA 步骤和 PROC 步骤。一个典型的程序以 DATA 步骤开始，用于创建一个 SAS 数据集，然后将数据传递给一个 PROC 步骤进行处理。

DATA 步骤和 PROC 步骤由声明构成。一个步骤可能有一个或数百个声明。大多数声明只在一种类型的步骤中起作用——在 DATA 步骤中但不在 PROC 步骤中，反之亦然。在大多数情况下，DATA 步骤用于读取和修改数据，而 PROC 步骤用于分析数据、执行功能或打印报告。


DATA 步骤以`DATA`声明开始。该关键字后面跟着一个你为 SAS 数据集取的名称。除了从外部原始数据文件读取数据外，DATA 步骤还可以包括 DO 循环、IF-THEN/ELSE 逻辑以及各种数值和字符函数。DATA 步骤还可以以几乎任何方式组合数据集。


另一方面，Procedure 步骤则以 `PROC` 声明开始，其中关键字后面跟着操作的名称（例如 `PRINT`、`SORT` 或 `MEANS`）。SAS 的 Procedure 可以执行从简单排序和打印到方差分析和3D图形等各种任务。

SAS 在遇到一个新的步骤（`DATA` 或 `PROC` 声明）; `RUN`、`QUIT`、`STOP` 或 `ABORT` 声明；或者（如果正在批处理模式下运行，）程序的结尾时，当前步骤会结束。`RUN` 声明告诉 SAS 运行该步骤之前的所有行，它是罕见的全局声明之一，不属于 DATA 或 PROC 步骤的一部分。

### 1.4 DATA 步骤的内置循环

DATA 步骤具有一个内在的结构，一个隐式的、内置的循环。DATA 步骤逐行执行，逐观测执行。逐行执行的概念相当直观且容易理解。这意味着，默认情况下，SAS 会先执行 DATA 步骤的第一行，之后执行第二行、第三行，以此类推。逐观测执行指 SAS 会取第一个观测并运行全部 DATA 步骤（如前文所述逐行进行），然后循环回来获取第二个观测。这样，SAS一次只处理一个观测。

这张图解说明了观测是如何通过一个 DATA 步骤的：

![Img](./FILES/ENG.md/img-20231229184406.png)


SAS 读取第一条观测并使用 DATA 步骤的第一行进行处理，然后是第二行，依此类推，直到 SAS 达到 DATA 步骤的末尾。然后，SAS 将该观测写入输出数据集。这张图说明了逐行循环的第一次执行。一旦 SAS 完成对第一个观测的处理，它会回到 DATA 步骤的顶部并获取第二个观测。当 SAS 完成最后一个观测时，它会自动停止。

除此之外，SAS提供了多种方法调用逐行和逐观测之外的结构。其中包括 `RETAIN` 声明和 `OUTPUT` 声明。